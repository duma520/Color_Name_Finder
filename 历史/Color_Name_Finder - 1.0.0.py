import sys
from PyQt5.QtWidgets import (QApplication, QMainWindow, QLabel, QVBoxLayout, 
                             QWidget, QPushButton, QTextEdit, QHBoxLayout)
from PyQt5.QtGui import QColor, QPixmap, QScreen, QPainter, QFont
from PyQt5.QtCore import Qt, QTimer, QPoint
import pyperclip

class ColorNameFinder:
    def __init__(self):
        # 国标颜色名称 (GSB05-1426-2001)
        self.gb_colors = {
            (255, 255, 255): "白色",
            (0, 0, 0): "黑色",
            (255, 0, 0): "红色",
            (0, 255, 0): "绿色",
            (0, 0, 255): "蓝色",
            (255, 255, 0): "黄色",
            (255, 0, 255): "品红",
            (0, 255, 255): "青色",
            (128, 128, 128): "灰色",
            (192, 192, 192): "银色",
            (255, 215, 0): "金色",
            (128, 0, 0): "深红色",
            (0, 128, 0): "深绿色",
            (0, 0, 128): "深蓝色",
            (128, 128, 0): "橄榄色",
            (128, 0, 128): "紫色",
            (0, 128, 128): "凫色",
            (255, 165, 0): "橙色",
            (255, 192, 203): "粉红色",
            (165, 42, 42): "棕色",
            (210, 180, 140): "浅棕色",
            (255, 250, 240): "象牙色",
            (245, 245, 220): "米色",
            (255, 255, 240): "象牙白",
            (250, 235, 215): "亚麻色",
            (255, 228, 196): "杏仁色",
            (255, 222, 173): "纳瓦白",
            (255, 218, 185): "桃色",
            (255, 228, 225): "雾玫瑰",
            (255, 235, 205): "贝壳色",
            (255, 239, 213): "香槟黄",
            (255, 245, 238): "海贝壳",
            (245, 222, 179): "小麦色",
            (255, 248, 220): "玉米丝",
            (255, 250, 205): "柠檬绸",
            (250, 250, 210): "浅黄色",
            (255, 255, 224): "浅金黄",
            (139, 69, 19): "赭色",
            (160, 82, 45): "赭石色",
            (210, 105, 30): "巧克力色",
            (244, 164, 96): "沙棕色",
            (222, 184, 135): "深卡其",
            (245, 245, 220): "米黄色",
            (255, 228, 181): "麦黄色",
            (255, 160, 122): "浅鲑红",
            (255, 127, 80): "珊瑚色",
            (255, 99, 71): "番茄红",
            (255, 69, 0): "橙红色",
            (178, 34, 34): "火砖色",
            (220, 20, 60): "猩红色",
            (255, 0, 0): "红色",
            (255, 105, 180): "热粉红",
            (255, 20, 147): "深粉红",
            (199, 21, 133): "中紫红",
            (219, 112, 147): "苍紫红",
            (255, 182, 193): "浅粉红",
            (255, 240, 245): "薰衣草",
            (255, 250, 250): "雪白色",
            (240, 255, 240): "蜜露橙",
            (245, 255, 250): "薄荷色",
            (240, 255, 255): "天蓝色",
            (240, 248, 255): "爱丽丝蓝",
            (230, 230, 250): "薰衣草",
            (216, 191, 216): "蓟色",
            (221, 160, 221): "浅紫色",
            (238, 130, 238): "紫罗兰",
            (218, 112, 214): "兰紫色",
            (186, 85, 211): "中紫色",
            (153, 50, 204): "深紫色",
            (148, 0, 211): "暗紫色",
            (138, 43, 226): "蓝紫色",
            (160, 32, 240): "紫藤色",
            (147, 112, 219): "中紫蓝",
            (123, 104, 238): "中石板蓝",
            (106, 90, 205): "中蓝紫",
            (72, 61, 139): "深石板蓝",
            (65, 105, 225): "皇家蓝",
            (0, 0, 205): "中蓝色",
            (0, 0, 139): "深蓝色",
            (0, 0, 128): "海军蓝",
            (25, 25, 112): "午夜蓝",
            (30, 144, 255): "道奇蓝",
            (100, 149, 237): "矢车菊",
            (70, 130, 180): "钢蓝色",
            (95, 158, 160): "青灰色",
            (0, 191, 255): "深天蓝",
            (135, 206, 235): "天蓝色",
            (135, 206, 250): "浅天蓝",
            (173, 216, 230): "浅蓝色",
            (176, 224, 230): "粉蓝色",
            (175, 238, 238): "苍绿色",
            (0, 206, 209): "深绿松石",
            (72, 209, 204): "中绿松石",
            (64, 224, 208): "绿松石",
            (0, 255, 255): "青色",
            (0, 139, 139): "深青色",
            (47, 79, 79): "深石板灰",
            (102, 205, 170): "中海蓝",
            (143, 188, 143): "暗海绿",
            (32, 178, 170): "浅海绿",
            (60, 179, 113): "中海绿",
            (46, 139, 87): "海绿色",
            (34, 139, 34): "森林绿",
            (0, 100, 0): "深绿色",
            (85, 107, 47): "暗橄榄绿",
            (107, 142, 35): "橄榄色",
            (154, 205, 50): "黄绿色",
            (50, 205, 50): "酸橙绿",
            (0, 255, 0): "绿色",
            (124, 252, 0): "草坪绿",
            (127, 255, 0): "查特绿",
            (173, 255, 47): "绿黄色",
            (210, 180, 140): "棕褐色",
            (255, 255, 0): "黄色",
            (255, 215, 0): "金色",
            (238, 232, 170): "苍金菊",
            (240, 230, 140): "卡其色",
            (250, 250, 210): "浅黄色",
            (255, 255, 224): "浅金黄",
            (255, 250, 205): "柠檬绸",
            (139, 137, 112): "暗卡其",
            (245, 222, 179): "小麦色",
            (255, 228, 181): "麦黄色",
            (255, 165, 0): "橙色",
            (255, 140, 0): "深橙色",
            (255, 127, 0): "橙红色",
            (255, 69, 0): "橙红色",
            (233, 150, 122): "深鲑红",
            (250, 128, 114): "鲑红色",
            (255, 160, 122): "浅鲑红",
            (255, 228, 196): "杏仁色",
            (255, 222, 173): "纳瓦白",
            (255, 218, 185): "桃色",
            (255, 228, 225): "雾玫瑰",
            (255, 235, 205): "贝壳色",
            (255, 239, 213): "香槟黄",
            (255, 245, 238): "海贝壳",
            (139, 0, 0): "深红色",
            (165, 42, 42): "棕色",
            (188, 143, 143): "玫瑰棕",
            (205, 92, 92): "印度红",
            (255, 0, 0): "红色",
            (255, 105, 180): "热粉红",
            (255, 20, 147): "深粉红",
            (199, 21, 133): "中紫红",
            (219, 112, 147): "苍紫红",
            (255, 182, 193): "浅粉红",
            (255, 240, 245): "薰衣草",
            (255, 250, 250): "雪白色",
            (240, 255, 240): "蜜露橙",
            (245, 255, 250): "薄荷色",
            (240, 255, 255): "天蓝色",
            (240, 248, 255): "爱丽丝蓝",
            (230, 230, 250): "薰衣草",
            (216, 191, 216): "蓟色",
            (221, 160, 221): "浅紫色",
            (238, 130, 238): "紫罗兰",
            (218, 112, 214): "兰紫色",
            (186, 85, 211): "中紫色",
            (153, 50, 204): "深紫色",
            (148, 0, 211): "暗紫色",
            (138, 43, 226): "蓝紫色",
            (160, 32, 240): "紫藤色",
            (147, 112, 219): "中紫蓝",
            (123, 104, 238): "中石板蓝",
            (106, 90, 205): "中蓝紫",
            (72, 61, 139): "深石板蓝",
            (65, 105, 225): "皇家蓝",
            (0, 0, 205): "中蓝色",
            (0, 0, 139): "深蓝色",
            (0, 0, 128): "海军蓝",
            (25, 25, 112): "午夜蓝",
            (30, 144, 255): "道奇蓝",
            (100, 149, 237): "矢车菊",
            (70, 130, 180): "钢蓝色",
            (95, 158, 160): "青灰色",
            (0, 191, 255): "深天蓝",
            (135, 206, 235): "天蓝色",
            (135, 206, 250): "浅天蓝",
            (173, 216, 230): "浅蓝色",
            (176, 224, 230): "粉蓝色",
            (175, 238, 238): "苍绿色",
            (0, 206, 209): "深绿松石",
            (72, 209, 204): "中绿松石",
            (64, 224, 208): "绿松石",
            (0, 255, 255): "青色",
            (0, 139, 139): "深青色",
            (47, 79, 79): "深石板灰",
            (102, 205, 170): "中海蓝",
            (143, 188, 143): "暗海绿",
            (32, 178, 170): "浅海绿",
            (60, 179, 113): "中海绿",
            (46, 139, 87): "海绿色",
            (34, 139, 34): "森林绿",
            (0, 100, 0): "深绿色",
            (85, 107, 47): "暗橄榄绿",
            (107, 142, 35): "橄榄色",
            (154, 205, 50): "黄绿色",
            (50, 205, 50): "酸橙绿",
            (0, 255, 0): "绿色",
            (124, 252, 0): "草坪绿",
            (127, 255, 0): "查特绿",
            (173, 255, 47): "绿黄色",
            (210, 180, 140): "棕褐色",
            (255, 255, 0): "黄色",
            (255, 215, 0): "金色",
            (238, 232, 170): "苍金菊",
            (240, 230, 140): "卡其色",
            (250, 250, 210): "浅黄色",
            (255, 255, 224): "浅金黄",
            (255, 250, 205): "柠檬绸",
            (139, 137, 112): "暗卡其",
            (245, 222, 179): "小麦色",
            (255, 228, 181): "麦黄色",
            (255, 165, 0): "橙色",
            (255, 140, 0): "深橙色",
            (255, 127, 0): "橙红色",
            (255, 69, 0): "橙红色",
            (233, 150, 122): "深鲑红",
            (250, 128, 114): "鲑红色",
            (255, 160, 122): "浅鲑红",
            (255, 228, 196): "杏仁色",
            (255, 222, 173): "纳瓦白",
            (255, 218, 185): "桃色",
            (255, 228, 225): "雾玫瑰",
            (255, 235, 205): "贝壳色",
            (255, 239, 213): "香槟黄",
            (255, 245, 238): "海贝壳",
            (139, 0, 0): "深红色",
            (165, 42, 42): "棕色",
            (188, 143, 143): "玫瑰棕",
            (205, 92, 92): "印度红",
            (255, 0, 0): "红色",
            (255, 105, 180): "热粉红",
            (255, 20, 147): "深粉红",
            (199, 21, 133): "中紫红",
            (219, 112, 147): "苍紫红",
            (255, 182, 193): "浅粉红",
            (255, 240, 245): "薰衣草",
            (255, 250, 250): "雪白色",
            (240, 255, 240): "蜜露橙",
            (245, 255, 250): "薄荷色",
            (240, 255, 255): "天蓝色",
            (240, 248, 255): "爱丽丝蓝",
            (230, 230, 250): "薰衣草",
            (216, 191, 216): "蓟色",
            (221, 160, 221): "浅紫色",
            (238, 130, 238): "紫罗兰",
            (218, 112, 214): "兰紫色",
            (186, 85, 211): "中紫色",
            (153, 50, 204): "深紫色",
            (148, 0, 211): "暗紫色",
            (138, 43, 226): "蓝紫色",
            (160, 32, 240): "紫藤色",
            (147, 112, 219): "中紫蓝",
            (123, 104, 238): "中石板蓝",
            (106, 90, 205): "中蓝紫",
            (72, 61, 139): "深石板蓝",
            (65, 105, 225): "皇家蓝",
            (0, 0, 205): "中蓝色",
            (0, 0, 139): "深蓝色",
            (0, 0, 128): "海军蓝",
            (25, 25, 112): "午夜蓝",
            (30, 144, 255): "道奇蓝",
            (100, 149, 237): "矢车菊",
            (70, 130, 180): "钢蓝色",
            (95, 158, 160): "青灰色",
            (0, 191, 255): "深天蓝",
            (135, 206, 235): "天蓝色",
            (135, 206, 250): "浅天蓝",
            (173, 216, 230): "浅蓝色",
            (176, 224, 230): "粉蓝色",
            (175, 238, 238): "苍绿色",
            (0, 206, 209): "深绿松石",
            (72, 209, 204): "中绿松石",
            (64, 224, 208): "绿松石",
            (0, 255, 255): "青色",
            (0, 139, 139): "深青色",
            (47, 79, 79): "深石板灰",
            (102, 205, 170): "中海蓝",
            (143, 188, 143): "暗海绿",
            (32, 178, 170): "浅海绿",
            (60, 179, 113): "中海绿",
            (46, 139, 87): "海绿色",
            (34, 139, 34): "森林绿",
            (0, 100, 0): "深绿色",
            (85, 107, 47): "暗橄榄绿",
            (107, 142, 35): "橄榄色",
            (154, 205, 50): "黄绿色",
            (50, 205, 50): "酸橙绿",
            (0, 255, 0): "绿色",
            (124, 252, 0): "草坪绿",
            (127, 255, 0): "查特绿",
            (173, 255, 47): "绿黄色",
            (210, 180, 140): "棕褐色",
            (255, 255, 0): "黄色",
            (255, 215, 0): "金色",
            (238, 232, 170): "苍金菊",
            (240, 230, 140): "卡其色",
            (250, 250, 210): "浅黄色",
            (255, 255, 224): "浅金黄",
            (255, 250, 205): "柠檬绸",
            (139, 137, 112): "暗卡其",
            (245, 222, 179): "小麦色",
            (255, 228, 181): "麦黄色",
            (255, 165, 0): "橙色",
            (255, 140, 0): "深橙色",
            (255, 127, 0): "橙红色",
            (255, 69, 0): "橙红色",
            (233, 150, 122): "深鲑红",
            (250, 128, 114): "鲑红色",
            (255, 160, 122): "浅鲑红",
            (255, 228, 196): "杏仁色",
            (255, 222, 173): "纳瓦白",
            (255, 218, 185): "桃色",
            (255, 228, 225): "雾玫瑰",
            (255, 235, 205): "贝壳色",
            (255, 239, 213): "香槟黄",
            (255, 245, 238): "海贝壳"
        }
        
        # 其他常见颜色名称
        self.other_colors = {
            (255, 248, 231): "象牙白",
            (255, 253, 208): "奶油色",
            (255, 252, 196): "香槟金",
            (255, 245, 223): "杏仁白",
            (255, 239, 219): "古董白",
            (255, 235, 205): "贝壳白",
            (255, 228, 225): "雾玫瑰",
            (255, 222, 173): "纳瓦白",
            (255, 218, 185): "桃色",
            (255, 214, 209): "贝壳粉",
            (255, 209, 220): "浅粉红",
            (255, 192, 203): "粉红色",
            (255, 182, 193): "浅粉红",
            (255, 174, 185): "粉玫瑰",
            (255, 160, 122): "浅鲑红",
            (255, 153, 153): "浅红",
            (255, 140, 105): "鲑红",
            (255, 127, 80): "珊瑚色",
            (255, 114, 86): "赭石红",
            (255, 99, 71): "番茄红",
            (255, 69, 0): "橙红色",
            (255, 64, 64): "火红",
            (255, 51, 51): "鲜红",
            (255, 0, 0): "红色",
            (238, 59, 59): "深红",
            (205, 55, 0): "赭红",
            (178, 34, 34): "火砖色",
            (139, 0, 0): "深红色",
            (128, 0, 0): "栗色",
            (112, 28, 28): "褐红",
            (105, 0, 0): "暗红",
            (255, 215, 0): "金色",
            (255, 193, 37): "金菊",
            (255, 185, 15): "金橙",
            (255, 165, 0): "橙色",
            (255, 153, 18): "橙黄",
            (255, 140, 0): "深橙色",
            (255, 128, 0): "橙红",
            (255, 117, 24): "南瓜橙",
            (255, 106, 0): "橙红",
            (255, 90, 0): "红橙",
            (255, 69, 0): "橙红色",
            (255, 56, 0): "朱红",
            (255, 36, 0): "猩红",
            (255, 0, 0): "红色",
            (238, 118, 0): "深橙",
            (205, 102, 0): "赭橙",
            (178, 89, 0): "褐橙",
            (139, 69, 19): "赭色",
            (128, 64, 0): "褐赭",
            (107, 36, 12): "深褐",
            (94, 38, 18): "咖啡色",
            (82, 42, 20): "深咖啡",
            (74, 38, 18): "黑咖啡",
            (61, 31, 15): "浓咖啡",
            (51, 26, 13): "特浓咖啡",
            (255, 255, 0): "黄色",
            (255, 246, 143): "金丝雀黄",
            (255, 239, 0): "柠檬黄",
            (255, 236, 139): "香蕉黄",
            (255, 231, 186): "玉米黄",
            (255, 228, 181): "麦黄色",
            (255, 222, 173): "纳瓦白",
            (255, 215, 0): "金色",
            (255, 193, 37): "金菊",
            (255, 185, 15): "金橙",
            (255, 165, 0): "橙色",
            (255, 153, 18): "橙黄",
            (255, 140, 0): "深橙色",
            (255, 128, 0): "橙红",
            (255, 117, 24): "南瓜橙",
            (255, 106, 0): "橙红",
            (255, 90, 0): "红橙",
            (255, 69, 0): "橙红色",
            (255, 56, 0): "朱红",
            (255, 36, 0): "猩红",
            (255, 0, 0): "红色",
            (238, 238, 0): "深黄",
            (205, 205, 0): "赭黄",
            (178, 178, 0): "褐黄",
            (139, 139, 0): "橄榄黄",
            (128, 128, 0): "橄榄色",
            (107, 107, 0): "深橄榄",
            (94, 94, 0): "暗橄榄",
            (82, 82, 0): "黑橄榄",
            (74, 74, 0): "浓橄榄",
            (61, 61, 0): "特浓橄榄",
            (51, 51, 0): "黑橄榄",
            (0, 255, 0): "绿色",
            (127, 255, 0): "查特绿",
            (124, 252, 0): "草坪绿",
            (118, 238, 0): "草绿",
            (102, 205, 0): "嫩绿",
            (89, 178, 0): "叶绿",
            (69, 139, 0): "森林绿",
            (64, 128, 0): "深绿",
            (56, 107, 0): "暗绿",
            (49, 94, 0): "墨绿",
            (43, 82, 0): "深墨绿",
            (38, 74, 0): "黑绿",
            (31, 61, 0): "特浓绿",
            (26, 51, 0): "黑绿",
            (0, 255, 127): "春绿",
            (0, 238, 118): "深春绿",
            (0, 205, 102): "赭春绿",
            (0, 178, 89): "褐春绿",
            (0, 139, 69): "森林春绿",
            (0, 128, 64): "深春绿",
            (0, 107, 56): "暗春绿",
            (0, 94, 49): "墨春绿",
            (0, 82, 43): "深墨春绿",
            (0, 74, 38): "黑春绿",
            (0, 61, 31): "特浓春绿",
            (0, 51, 26): "黑春绿",
            (0, 255, 255): "青色",
            (0, 238, 238): "深青",
            (0, 205, 205): "赭青",
            (0, 178, 178): "褐青",
            (0, 139, 139): "凫色",
            (0, 128, 128): "凫色",
            (0, 107, 107): "深凫",
            (0, 94, 94): "暗凫",
            (0, 82, 82): "深墨凫",
            (0, 74, 74): "黑凫",
            (0, 61, 61): "特浓凫",
            (0, 51, 51): "黑凫",
            (0, 0, 255): "蓝色",
            (0, 0, 238): "深蓝",
            (0, 0, 205): "中蓝",
            (0, 0, 178): "褐蓝",
            (0, 0, 139): "深蓝色",
            (0, 0, 128): "海军蓝",
            (0, 0, 107): "深海军",
            (0, 0, 94): "暗海军",
            (0, 0, 82): "深墨海军",
            (0, 0, 74): "黑海军",
            (0, 0, 61): "特浓海军",
            (0, 0, 51): "黑海军",
            (138, 43, 226): "蓝紫色",
            (148, 0, 211): "暗紫色",
            (153, 50, 204): "深紫色",
            (186, 85, 211): "中紫色",
            (218, 112, 214): "兰紫色",
            (238, 130, 238): "紫罗兰",
            (221, 160, 221): "浅紫色",
            (216, 191, 216): "蓟色",
            (230, 230, 250): "薰衣草",
            (240, 248, 255): "爱丽丝蓝",
            (240, 255, 255): "天蓝色",
            (240, 255, 240): "蜜露橙",
            (245, 255, 250): "薄荷色",
            (255, 240, 245): "薰衣草",
            (255, 250, 250): "雪白色",
            (255, 255, 240): "象牙白",
            (255, 255, 255): "白色",
            (245, 245, 245): "白烟",
            (220, 220, 220): "淡灰",
            (211, 211, 211): "浅灰",
            (192, 192, 192): "银色",
            (169, 169, 169): "深灰",
            (128, 128, 128): "灰色",
            (105, 105, 105): "暗灰",
            (119, 136, 153): "浅石板灰",
            (112, 128, 144): "石板灰",
            (47, 79, 79): "深石板灰",
            (0, 0, 0): "黑色"
        }

    def find_closest_color(self, rgb):
        """查找最接近的颜色名称"""
        r, g, b = rgb
        
        # 首先检查是否有精确匹配
        if (r, g, b) in self.gb_colors:
            return self.gb_colors[(r, g, b)]
        
        if (r, g, b) in self.other_colors:
            return self.other_colors[(r, g, b)]
        
        # 如果没有精确匹配，则查找最接近的颜色
        def color_distance(c1, c2):
            return sum((a - b) ** 2 for a, b in zip(c1, c2))
        
        # 合并所有颜色
        all_colors = {**self.gb_colors, **self.other_colors}
        
        # 查找最接近的颜色
        closest_color = min(all_colors.keys(), key=lambda color: color_distance(color, rgb))
        return all_colors[closest_color]

    def get_all_color_names(self, rgb):
        """获取颜色的所有名称"""
        r, g, b = rgb
        names = set()
        
        if (r, g, b) in self.gb_colors:
            names.add(f"国标: {self.gb_colors[(r, g, b)]}")
        
        if (r, g, b) in self.other_colors:
            names.add(f"其他: {self.other_colors[(r, g, b)]}")
        
        if not names:
            closest_name = self.find_closest_color(rgb)
            names.add(f"近似: {closest_name}")
        
        return list(names)

class ColorPickerWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        
        self.color_finder = ColorNameFinder()
        self.initUI()
        
        # 定时器用于实时获取鼠标位置颜色
        self.timer = QTimer(self)
        self.timer.timeout.connect(self.update_color)
        self.picking = False
        
    def initUI(self):
        self.setWindowTitle('颜色名称识别器')
        self.setGeometry(100, 100, 500, 400)
        
        # 主窗口布局
        central_widget = QWidget()
        self.setCentralWidget(central_widget)
        layout = QVBoxLayout()
        central_widget.setLayout(layout)
        
        # 颜色预览区域
        self.color_preview = QLabel()
        self.color_preview.setFixedHeight(100)
        self.color_preview.setStyleSheet("background-color: white; border: 1px solid black;")
        layout.addWidget(self.color_preview)
        
        # RGB值显示
        self.rgb_label = QLabel("RGB: 未选择")
        layout.addWidget(self.rgb_label)
        
        # 颜色名称显示
        self.color_name_label = QLabel("颜色名称: 未选择")
        layout.addWidget(self.color_name_label)
        
        # 所有颜色名称显示
        self.all_names_text = QTextEdit()
        self.all_names_text.setReadOnly(True)
        self.all_names_text.setPlaceholderText("所有已知颜色名称将显示在这里...")
        layout.addWidget(self.all_names_text)
        
        # 按钮布局
        button_layout = QHBoxLayout()
        
        # 开始拾取按钮
        self.pick_button = QPushButton("开始拾取颜色")
        self.pick_button.clicked.connect(self.start_picking)
        button_layout.addWidget(self.pick_button)
        
        # 停止拾取按钮
        self.stop_button = QPushButton("停止拾取")
        self.stop_button.clicked.connect(self.stop_picking)
        self.stop_button.setEnabled(False)
        button_layout.addWidget(self.stop_button)
        
        # 复制按钮
        self.copy_button = QPushButton("复制颜色信息")
        self.copy_button.clicked.connect(self.copy_color_info)
        button_layout.addWidget(self.copy_button)
        
        layout.addLayout(button_layout)
        
        # 设置字体
        font = QFont("Microsoft YaHei", 10)
        self.setFont(font)
        
    def start_picking(self):
        self.picking = True
        self.pick_button.setEnabled(False)
        self.stop_button.setEnabled(True)
        self.timer.start(100)  # 每100毫秒更新一次
        
    def stop_picking(self):
        self.picking = False
        self.pick_button.setEnabled(True)
        self.stop_button.setEnabled(False)
        self.timer.stop()
        
    def update_color(self):
        if not self.picking:
            return
            
        # 获取鼠标位置
        cursor_pos = QApplication.desktop().cursor().pos()
        
        # 获取屏幕截图
        screen = QApplication.primaryScreen()
        pixmap = screen.grabWindow(0, cursor_pos.x(), cursor_pos.y(), 1, 1)
        
        # 获取像素颜色
        image = pixmap.toImage()
        color = QColor(image.pixel(0, 0))
        r, g, b = color.red(), color.green(), color.blue()
        
        # 更新UI
        self.update_color_display(r, g, b)
        
    def update_color_display(self, r, g, b):
        # 更新颜色预览
        self.color_preview.setStyleSheet(f"background-color: rgb({r}, {g}, {b}); border: 1px solid black;")
        
        # 更新RGB值
        self.rgb_label.setText(f"RGB: ({r}, {g}, {b})")
        
        # 获取颜色名称
        color_names = self.color_finder.get_all_color_names((r, g, b))
        
        # 显示主要颜色名称
        if color_names:
            primary_name = color_names[0].split(": ")[1]
            self.color_name_label.setText(f"颜色名称: {primary_name}")
        else:
            self.color_name_label.setText("颜色名称: 未知")
        
        # 显示所有颜色名称
        self.all_names_text.clear()
        self.all_names_text.append("所有已知名称:")
        for name in color_names:
            self.all_names_text.append(f"  - {name}")
        
    def copy_color_info(self):
        # 获取当前颜色信息
        rgb_text = self.rgb_label.text()
        name_text = self.color_name_label.text()
        all_names = self.all_names_text.toPlainText()
        
        # 组合文本
        text_to_copy = f"{rgb_text}\n{name_text}\n{all_names}"
        
        # 复制到剪贴板
        pyperclip.copy(text_to_copy)
        
        # 显示提示
        self.statusBar().showMessage("颜色信息已复制到剪贴板", 2000)

if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = ColorPickerWindow()
    window.show()
    sys.exit(app.exec_())